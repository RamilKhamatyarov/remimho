name: Build & Release with jpackage

on:
  push:
    tags:
      - 'v*'
  pull_request:
    branches:
      - main

permissions:
  contents: read
  pull-requests: write

jobs:
  build:
    name: Build Remimho Installer
    runs-on: windows-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Java 21
        uses: actions/setup-java@v4
        with:
          java-version: '21'
          distribution: 'temurin'
          cache: gradle

      - name: Run tests
        run: gradle test

      - name: Lint code
        run: gradle ktlintCheck

      - name: Build summary
        if: success()
        run: |
          echo "SUCCESS: Build completed!"
          echo "Installer location: build/installers/"
          echo "Ready for itch.io upload"
